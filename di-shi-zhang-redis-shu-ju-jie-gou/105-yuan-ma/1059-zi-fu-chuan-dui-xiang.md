# 字符串对象 {#字符串对象}

### 概述 {#概述}

字符串对象的编码可以是int raw embstr

1. 如果一个字符串对象保存的是整数值，并且这个整数值用long型可以表示，那么`*void`转化为long类型，将字符串编码设置为int型。
2. 如果字符串保存的是一个字符串值，并且这个字符串值的长度大于32字节，那么对象使用简单动态字符串来保存值，字符串编码设置为raw
3. 如果字符串对象保存的是一个字符串值，并且这个字符串值的长度小于等于32字节，那么字符串对象将使用embstr编码方式来保存这个值。embstr是专门用于保存短字符串值的一种优化编码方式。都是为redisObject和sdshdr分配函数，只不过，embstr一次分配一块连续的空间。无操作，是只读类型的。

### 编码转换 {#编码转换}

如果int对象在某次执行操作后不再是一个整数值，而是一个字符串值，就会转化成raw类型，比如APPEND操作 embstr类型的字符串在执行任何修改操作后都会变成raw类型的对象

### 字符串命令 {#字符串命令}

| 命令 | int编码的实现方式 | embstr编码的实现方式 | raw编码的实现方式 |
| :--- | :--- | :--- | :--- |
| SET | int编码方式保存 | 使用embstr编码保存值 | 使用raw编码保存值 |
| GET | 拷贝对象所保存的值，将拷贝转换成字符串值，然后向客户端返回 | 直接向客户端返回字符串值 | 直接向客户端返回字符串值 |
| APPEND | 将对象转化为raw编码，执行操作 | 将对象转化为raw编码执行操作 | 调用sdscatlen函数，追加字符到末尾 |
| INCRBYFLOAT | 取出整数值，转化为long double型浮点数，计算后保存 | 转化，如果失败返回错误 | 转化为long double 失败就返回一个错误 |
| INCRBY | 整数加法 | 同上 | 同上 |
| DECRBY | 整数减法 | 同上 | 同上 |
| STRLEN | 拷贝对象所保存的值，将这个拷贝转化成字符串值，计算并返回这个字符串的长度 | 调用sdslen函数 | sdslen函数 |
| SETRANGE | 将对象转化为raw类型 | 将对象转换成raw编码，然后按raw编码方式执行此命令 | 将字符串特定索引上的值设置为给定的字符 |
| GETRANGE | slice操作，可以取负值。拷贝对象，转化成字符串值，取出指定索引上的字符 | 直接取出并返回索引上的字符 | 直接取出并返回索引上的字符 |



