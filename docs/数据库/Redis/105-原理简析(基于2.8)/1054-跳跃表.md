# 跳跃表 {#跳跃表}

### 概述 {#概述}

跳跃表是一种有序数据结构，通过在每个节点中维持多个指向其他节点的指针，从而达到快速访问节点的目的。 支持平均O\(logN\),最坏O\(N\)复杂度的查找。 Redis使用跳跃表作为有序集合键的底层实现之一，如果有一个有序集合包含的元素数量较多，或者有序集合中元素的成员是比较长的字符串时，采用跳跃表作为有序集合键底层的实现。

```
/*
 * 跳跃表节点
 */
typedef struct zskiplistNode {

    // 成员对象
    robj *obj;

    // 分值，节点按照各自所保存的分值从小到大排列
    double score;

    // 后退指针,用于表尾向表头遍历时使用
    struct zskiplistNode *backward;

    // 层,通过层中的指针加快对其他节点的访问，层数越多，速度越快
    struct zskiplistLevel {

        // 前进指针，表尾方向的节点
        struct zskiplistNode *forward;

        // 跨度，指针所指节点与当前结点的距离
        unsigned int span;

    } level[];

} zskiplistNode;
```

```
/*
 * 跳跃表
 */
typedef struct zskiplist {

    // 表头节点和表尾节点
    struct zskiplistNode *header, *tail;

    // 表中节点的数量
    unsigned long length;

    // 表中层数最大的节点的层数
    int level;

} zskiplist;
```

* 层 每次创建一个新跳跃表节点的时候，程序都根据幂次定律\(越大的数出现的概率越小\)随机生成一个介于1~32之间的值作为level数组的大小，这个大小就是层的高度

* 前进指针 每个层都有一个指向表尾方向的前进指针，用于从表头向表尾方向访问节点。level\[i\].forward属性

* 跨度 层的跨度level\[i\].span属性用于记录两个节点之间的距离。指向NULL的前进指针跨度为0.跨度实际上是用来计算排位的。在查找某个节点的过程中，将沿途访问过的所有层的跨度累计起来，得到的就是目标节点在跳跃表中的排位。

* 后退指针 节点的backward属性，每次只后退至前一个节点

* 分值和成员 节点的分值score属性是一个double类型的浮点数，跳跃表中的节点基于此排序\(有序表\)。 节点的成员对象obj属性是一个指针，指向一个字符串对象，字符串对象中保存着一个sds值。

在同一个跳跃表中，各个节点保存的成员对象必须唯一，多个节点保存的分值可以相同；分值相同的节点将按照成员对象在字典序中的大小进行排序。

