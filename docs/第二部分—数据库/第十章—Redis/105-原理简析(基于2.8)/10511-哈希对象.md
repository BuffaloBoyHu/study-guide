# 哈希对象 {#哈希对象}

### 概述 {#概述}

哈希对象的编码可以是ziplist或者hashtable ziplist编码的哈希对象使用压缩列表作为底层实现，新键值插入到哈希对象时，程序会先将保存了键的压缩列表节点推入到压缩列表结尾，然后再将保存了值的压缩列表节点推入到压缩列表表尾。

* 保存了同一键值的两个节点总是紧挨一起，保存键的节点在前，保存值的节点在后；
* 先添加到哈希对象中的键值对会被放到压缩列表的表头方向，后来的在表尾方向

```
> HSET profile name "yao"
  (integer) 1
> HSET profile age 25
  (integer) 1
```

上述操作执行HSET命令，服务器将创建一个列表对象作为profile的键的值\(值是一组键值对\)

hashtable编码的哈希对象使用字典作为底层实现，哈希对象中的每个键值对都使用一个字典键值对来保存

* 字典的每个键都是一个字符串对象，对象中保存了键值对的键
* 字典的每个值都是一个字符串对象，对象中保存流量键值对的值

### 编码转换 {#编码转换}

当哈希对象可以同时**满足**以下两个条件时，使用ziplist编码:

* 哈希对象所保存的所有键值对的键值的字符串长度都小于64字节；
* 哈希对象保存的键值对数量小于512个；
* 不能满足这两个条件的哈希对象需要使用hashtable编码，上限值可以修改 hash-max-ziplistt-value

### 哈希命令的实现 {#哈希命令的实现}

| 命令 | ziplist编码实现方法 | hashtable编码的实现方式 |
| :--- | :--- | :--- |
| HSET | 首先调用ziplistPush函数，将键推入压缩列表的表尾，再次调用ziplistPush函数，将值推入到压缩列表的表尾 | 调用dictdd函数，将新节点添加到词典中 |
| HGET | 首先调用ziplistFind函数，在压缩列表中查找对应的节点然后调用ziplistNext函数，将指针移动到键节点旁边的值节点，最后返回值节点 | 调用dictFind函数，在字典中查找给定键，然后调用dictGetVal函数 |
| HEXISTS | 调用ziplistFind函数 | 调用dictFind函数 |
| HDEL | 调用ziplistFind函数，定位键节点，将键节点以及对应的值节点删除 | 调用dictDelete函数，将键所对应的值删除 |
| HLEN | 调用ziplistLen函数，取得长度/2，就是哈希长度 | 调用dictSize函数，返回键值对数量 |
| HGETALL | 遍历压缩列表，用ziplistGet函数返回所有键值，即全部节点 | 遍历字典，用dictGetKey返回字典的键，dictGetValue返回字典的值 |



