# 整数集合 {#整数集合}

### 概述 {#概述}

整数集合是集合键的底层实现之一，当一个集合只包含整数值元素，并且这个元素的集合数量不多时，使用整数集合作为集合键的底层实现。

```
/*
 * 整数集合
 */
typedef struct intset {

    // 编码方式
    uint32_t encoding;

    // 集合包含的元素数量，数组长度
    uint32_t length;

    // 保存元素的数组，各个项在数组中按值的大小从小到大有序地排列，不包含重复项，实际类型取决于encoding属性
    int8_t contents[];

} intset;
```

### 升级 {#升级}

当将一个新元素添加到整数集合时，并且新元素类型比整数集合现有所有元素的类型都要长时，整数集合需要先进行升级，然后才能添加新元素。 每次升级需要对底层数组中已有的所有元素进行类型转换，所以向整数集合添加新元素的时间复杂度为O\(N\)

1. 根据新元素的类型，扩展整数集合底层数组的空间大小，并为新元素分配空间
2. 将底层数组现有的所有元素转换成与新元素相同的类型，并将类型转换后的元素放置到正确的位上，保证有序。新元素在首部或者末尾
3. 将新元素添加到数组中。



